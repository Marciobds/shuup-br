{% extends "shuup/front/base.jinja" %}
{%- import "shuup_br/macros.jinja" as shuup_br_macros with context -%}

{% block title %}{% trans %}Thank you for your order!{% endtrans %}{% endblock %}
{% block content_title %}{% trans name=order.billing_address.name %}Thank you for your order!{% endtrans %}{% endblock %}

{% block content %}
    <p><i class="fa fa-check text-success"></i> {% trans %}Your order has been received. You can see the details of your order below.{% endtrans %}</p>
    <hr>
    {% if user.id and activation_form %}
        <form role="form" method="post" action="{{ url("user_activation", pk=user.id) }}">
            <legend>{% trans %}User account activation{% endtrans %}</legend>
            {% csrf_token %}
            <p>{% trans email=user.email %}If you want to be able to see your order history, please create a password for your account: {% endtrans %}<strong>{{ email }}</strong></p>
            {% for field in activation_form %}
                {{ macros.render_field(field) }}
            {% endfor %}
            <button type="submit" class="btn btn-primary btn-lg">{% trans %}Send{% endtrans %}</button>
        </form>
    {% endif %}

    {{ print_order_detail(order, True) }}
{% endblock %}

{% macro print_order_detail(order, show_attachments=False) %}

    <div class="panel panel-default">
        <div class="panel-heading">
            <h2 class="panel-title">{% trans %}Products ordered{% endtrans %}</h2>
        </div>
        <div class="panel-body">
            {% set lines = order.lines.order_by("ordering") %}
            {% include "shuup/front/order/partials/product_table.jinja" %}
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h2 class="panel-title">{% trans %}Tax breakdown{% endtrans %}</h2>
        </div>
        <div class="panel-body">
            {% include "shuup/front/order/partials/taxes.jinja" %}
        </div>
    </div>

    {% if show_attachments %}
        {{ macros.render_ordered_files(order) }}
    {% endif %}

    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">{% trans %}Delivery{% endtrans %}</h2>
                </div>
                <div class="panel-body">
                    <dl class="dl-horizontal">
                        <dt>{% trans %}Delivery method{% endtrans %}:</dt>
                        <dd>{{ order.shipping_method_name }}</dd>
                        <dt>{% trans %}Shipping address{% endtrans %}:</dt>
                        <dd>
                            {{ shuup_br_macros.format_address(order.shipping_address) }}
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">{% trans %}Payment{% endtrans %}</h2>
                </div>
                <div class="panel-body">
                    <dl class="dl-horizontal">
                        <dt>{% trans %}Payment method{% endtrans %}:</dt>
                        <dd>{{ order.payment_method_name }}</dd>
                        <dt>{% trans %}Billing address{% endtrans %}:</dt>
                        <dd>
                            {{ shuup_br_macros.format_address(order.billing_address) }}
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    {% if order.company %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2 class="panel-title">{% trans %}Company{% endtrans %}</h2>
            </div>
            <div class="panel-body">
                <p>{{ order.company.name }} ({% trans %}Tax number{% endtrans %}: {{ order.company.tax_number }})</p>
            </div>
        </div>
    {% endif %}

{% endmacro %}
